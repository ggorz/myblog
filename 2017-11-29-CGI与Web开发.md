---
layout: post
title: CGI与web开发
date: 2017-11-29 09:48:08
categories: CGI
---



转载:[CGI与web开发](http://blog.csdn.net/guoke312/article/details/53405420)
其实各种语言都可以编写CGI，不但Java、Python、PHP、C#……可以，而且Shell也可以。当然C和C++也可以；CGI的痛点与FastCGI；
文章有删减详细可以看原文。

<!-- excerpt -->
<!-- toc -->

### C++后台实践：古老的CGI与Web开发

> 谈到web开发，大家首先想到的PHP、JavaEE/JSP、.NET/ASP、Ruby on rails、Python的Django等等。可谓百花齐放，你一般不会想到C++和Web开发有什么关系，但其实动态网页的开发（web开发）可是在这些动态网页语言诞生之前就存在了的。所以C/C++也是可以做web开发的，它利用的技术是——CGI。  
在天地初开，混沌未分之时，动态网页语言尚未出世，要实现动态网站依赖的就是CGI。谷歌/百度一下CGI，可能会出现很多名词：CGI脚本、CGI程序、CGI标准等等。其实这些都是站在不同角度来说的，CGI即Common Gateway Interface的缩写，直译为“通用网关接口”。第一次听这个名字，我也不知道是个什么鬼东西。归根结底 CGI就是一个接口协议。协议就是大家公认的一套标准（叫CGI标准也可以），比如网络协议。大家都遵守一套标准，就减少了沟通的难度。进行CGI开发，就是编写一个CGI可执行程序。其实各种语言都可以编写CGI，不但Java、Python、PHP、C#……可以，而且Shell也可以。当然C和C++也可以。由于早期CGI很多是由Perl（脚本语言）开发的，所以CGI程序也称CGI脚本，其实这个称呼不一定准确。因为C++编译出的可执行文件同样可以是CGI。  
 在PHP和Java大行其道的今天，很多人看来用C++编写CGI是几乎淘汰的技术了（其实这到不然，只是比较小众罢了）。所以如果你对C/C++感兴趣或者对历史感兴趣都可以阅读本文。  
 
#### 一次网页请求与响应
在进行网页浏览时，通常就是通过一个URL请求一个网页，然后服务器返回这个网页文件给浏览器。浏览器在本地解析该文件渲染成我们看到的网页。然而通常我们看到的网页不是静态网页，也就是说在服务端是没有这个网页文件，它是在网页请求的时候动态生成的，比如PHP/JSP网页。依据你请求的参数不同，所返回的内容不同。  

 同理，如果是请求一个CGI程序的时候（比如在浏览器直接输入CGI程序的URL，或者提交表单的时候发送给CGI程序），CGI程序负责解析从前端传递过来的参数，理解它的意图然后返回数据，比如返回HTML、XML或JSON等。
WARNNING：Apache默认没有打开CGI的支持，需要进行CGI的配置。具体方法可以自行百度。  

#### CGI的痛点与FastCGI
CGI是一种标准，并不限定语言。所以Java、PHP、Python都可以通过这种方式来生成动态网页。但是实际上这些动态语言却很少这样用。原来是CGI有一大硬伤。那就是每次CGI请求，那么Apache都有启动一个进程去执行这个CGI程序，即颇具Unix特色的fork-and-execute。当用户请求量大的时候，这个fork-and-execute的操作会严重拖慢Server的进程。而Java的Servlet技术则是一种常驻内存的技术，不会频繁的发生进程上下文的创建和销毁操作。  
时势造英雄，FastCGI技术应运而生。简单来说，其本质就是一个常驻内存的进程池技术，由调度器负责将传递过来的CGI请求发送给处理CGI的handler进程来处理。在一个请求处理完成之后，该处理进程不销毁，继续等待下一个请求的到来。FCGI技术一出，CGI又一定程度上焕发了第二春。PHP-FPM本身是使PHP支持FCGI技术的一个Patch，现在已经被纳入PHP标准。当然，支持C++的FCGI技术也出现了，Apache有FCGI的模块可以安装，比如mod_fcgid。  

#### 现代CGI的编程范式
前面我们知道，CGI可以直接返回一个html网页。CGI程序本身也可以进行各种计算、逻辑处理任务。随着各类web前后端技术的发展，以及大数据、高并发的Server使用场景越来越多。现代的CGI的用法，在发生变化。  
现在，越来越多的任务从后端转移到前端，前端页面利用丰富的Js技术来进行更多的处理。  
1.JS可以使用Ajax技术来向后台CGI发起数据请求。Ajax完成的是不需要刷新整个页面就可以加载后端数据（比如从数据库中取出）。  
2.CGI一般不再用于直接返回html页面，同时将复杂的计算、IO任务下沉到后端（后端可以进一步进行路由转发，实现负载均衡）。使CGI作为前后端之间的中间层。彼时CGI的职能是完成基本的数据交换：解析前端数据请求，再转发给对应后端；然后从后端取回数据，给前端返回XML或JSON。  
3.前端JS利用XML/JSON中的数据来进行填充，绘制出丰富的页面。